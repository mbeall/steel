language: php
php:
- '7'
- '5.6'
env:
- WP_VERSION=master
- WP_VERSION=4.4
- WP_VERSION=4.3
matrix:
  allow_failures:
  - env: WP_VERSION=4.3
  - env: WP_VERSION=4.4
  fast_finish: true
install:
- npm install
- composer install
- grunt init
cache:
  directories:
    - node_modules
    - vendor
before_script:
- mkdir -p /tmp/wordpress
- git clone --depth=1 --branch="$WP_VERSION" git://develop.git.wordpress.org/ /tmp/wordpress/
- plugin_slug=$(basename $(pwd))
- plugin_dir=/tmp/wordpress/src/wp-content/plugins/$plugin_slug
- cd ..
- mv $plugin_slug $plugin_dir
- cd /tmp/wordpress
- echo /tmp/wordpress
- cp wp-tests-config-sample.php wp-tests-config.php
- sed -i "s/youremptytestdbnamehere/wordpress_test/" wp-tests-config.php
- sed -i "s/yourusernamehere/root/" wp-tests-config.php
- sed -i "s/yourpasswordhere//" wp-tests-config.php
- mysql -e 'CREATE DATABASE wordpress_test;' -uroot
- cd $plugin_dir
- phpenv rehash
script:
- npm test
notifications:
  email: false
  slack:
    secure: JgFwx+H9kJunFwUbeRH4CA+q/Hl51afpHmohGrq2nieX9T3lEdDteDiwOH3/IxWItojtLVkGpkCWT8qB8vrqyod5WhZwN2a+9Ei3xyIkR95nOIsRtgBM4LdwDeXe3m7p/CXsVM28aamY5dzaPKieZ3T7b9lp+Bpl0ghrL7jyhH0=
